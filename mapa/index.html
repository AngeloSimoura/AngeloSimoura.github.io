<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
	 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
   <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />
   <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
	   		integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
	   		crossorigin=""> 	
	   </script>
	   <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
	<title>MAPA</title>
</head>
<body style="color: white;background-color: black;">
	<div style="text-align: center; font-size: 20px">
	Calcular distância entre sua posição e a latitude e longitude desejados:
	<p><input type="text" id="latuser" placeholder="Latitude"/></p>
	<p><input type="text" id="longuser" placeholder="Longitude"/></p>
	<button type="button" id="submit">CALCULAR</button>
	</div>
	
	<h1>MAPA</h1>
	<div id="map" style="height: 500px"></div>
	<script>

		var map = L.map('map').setView([51.505, -0.09], 13);
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
		    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		    maxZoom: 18,
		    id: 'mapbox.streets',
		    accessToken: 'pk.eyJ1IjoiYW5nZWxvc2ltb3VyYSIsImEiOiJjam9lNWhrMzMydmttM2tubDM1bDdybmw5In0.b66tjB6GE_aL3HGfankLiQ'
		}).addTo(map); 
		navigator.geolocation.getCurrentPosition(f1);
		function f1(pos){

			console.log(pos);
			var lat = pos.coords.latitude;
			var long = pos.coords.longitude;
			map.setView([lat,long],13);
			var marker = L.marker([lat, long]).addTo(map);
			marker.bindPopup("<b>Olá!</b><br> Você está aqui").openPopup();
			btn = document.getElementById("submit");
 			btn.addEventListener("click",distancia);
 			var dis=0;
 					
			function distancia(){
				var latuser = document.getElementById("latuser").value;
				var longuser= document.getElementById("longuser").value;
				var marker2 = L.marker([latuser, longuser]).addTo(map);
				var deg2rad = 0.017453292519943295; // === Math.PI / 180
				var cos = Math.cos;
				    lat *= deg2rad;
					long *= deg2rad;
				      latuser *= deg2rad;
				      longuser *= deg2rad;
				      var diam = 12742; // Diameter of the earth in km (2 * 6371)
				      var dLat = latuser - lat;
				      var dLon = longuser - long;
				      var a = ( (1 - cos(dLat)) +(1 - cos(dLon)) * cos(lat) * cos(longuser)) / 2;
				      var dis = diam * Math.asin(Math.sqrt(a)) * 1000;
				      marker2.bindPopup("<b>Olá!</b><br> Localização Escolhida -Distancia = " + dis.toFixed(2)  + " metros").openPopup();
				  	

				  };
				}
			navigator.geolocation.getCurrentPosition(f1,f2);

		//ERRO
		function f2(err){
			console.warn('ERROR(' + err.code + '): ' + err.message);
			alert("Você negou o acesso a sua Localização. Recarregue a página e tente novamente.");
			
		}
		
		</script>
		   	
</body>
</html>